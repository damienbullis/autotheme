package constants

import (
	"os"
	"strings"

	"github.com/lucasb-eyer/go-colorful"
)

var emojiSupported bool

func init() {
	emojiSupported = supportsEmoji()
}

func supportsEmoji() bool {
	termProgram := os.Getenv("TERM_PROGRAM")
	termEmulator := os.Getenv("TERM_EMULATOR")
	// Check if the terminal is likely to support emoji
	return termProgram == "Apple_Terminal" ||
		termProgram == "vscode" ||
		termEmulator == "tmux" ||
		termEmulator == "alacritty" ||
		termEmulator == "iterm"
}

type IconFallbackMap map[Icons]string

var fallbackMap = IconFallbackMap{
	IconCheck:     "[‚àö]",
	IconCross:     "[x]",
	IconWarn:      "[!]",
	IconWait:      "[...]",
	IconWrench:    "",
	IconRocket:    "",
	IconFire:      "",
	IconStar:      "[*]",
	IconLightning: "[~]",
	IconSparkles:  "[*]",
	IconRainbow:   "[~]",
	IconPalette:   "",
	IconPackage:   "",
}

type Icons string

const (
	// ASCII
	IconCheck     Icons = "‚úî"
	IconCross     Icons = "‚úò"
	IconWarn      Icons = "‚ö†"
	IconLightning Icons = "‚ö°Ô∏è"
	// Emoji
	IconWait     Icons = "‚åõ"
	IconWrench   Icons = "üîß"
	IconRocket   Icons = "üöÄ"
	IconFire     Icons = "üî•"
	IconStar     Icons = "üåü"
	IconSparkles Icons = "‚ú®"
	IconRainbow  Icons = "üåà"
	IconPalette  Icons = "üé®"
	IconPackage  Icons = "üì¶"
)

func (i Icons) Str() string {
	if emojiSupported {
		return string(i)
	}
	return fallbackMap[i]
}

type Anims string

const (
	AnimDots     Anims = "‚†ã‚†ô‚†ö‚†û‚†ñ‚†¶‚†¥‚†≤‚†≥‚†ì"
	AnimDots2    Anims = "‚£æ‚£Ω‚£ª‚¢ø‚°ø‚£ü‚£Ø‚£∑"
	AnimBars     Anims = "‚ñÅ‚ñÉ‚ñÑ‚ñÖ‚ñÜ‚ñá‚ñà‚ñá‚ñÜ‚ñÖ‚ñÑ‚ñÉ"
	AnimGradient Anims = "‚ñà‚ñì‚ñí‚ñë"
	AnimSquare   Anims = "‚ó∞‚ó≥‚ó≤‚ó±"
	AnimCircle   Anims = "‚ó¥‚ó∑‚ó∂‚óµ"
	AnimArc      Anims = "‚óú‚óù‚óû‚óü"
	AnimBounce   Anims = "‚†Å‚†Ç‚†Ñ‚†Ç"
)

type Stages string

const (
	StageInit  Stages = "INIT"
	StageBuild Stages = "BUILD"
	StageDone  Stages = "DONE"
)

type Colors map[string]colorful.Color

var (
	// Colors
	black   = colorful.Color{R: 0, G: 0, B: 0}
	white   = colorful.Color{R: 1, G: 1, B: 1}
	red     = colorful.Color{R: 1, G: 0, B: 0}
	green   = colorful.Color{R: 0, G: 1, B: 0}
	blue    = colorful.Color{R: 0, G: 0, B: 1}
	yellow  = colorful.Color{R: 1, G: 1, B: 0}
	cyan    = colorful.Color{R: 0, G: 1, B: 1}
	magenta = colorful.Color{R: 1, G: 0, B: 1}
	grey    = colorful.Color{R: 0.5, G: 0.5, B: 0.5}
	orange  = colorful.Color{R: 1, G: 0.5, B: 0}
	purple  = colorful.Color{R: 0.5, G: 0, B: 1}
	pink    = colorful.Color{R: 1, G: 0, B: 0.5}
	teal    = colorful.Color{R: 0, G: 0.5, B: 1}
	// ColorMap
	ColorMap = Colors{
		"black":   black,
		"white":   white,
		"red":     red,
		"green":   green,
		"blue":    blue,
		"yellow":  yellow,
		"cyan":    cyan,
		"magenta": magenta,
		"grey":    grey,
		"orange":  orange,
		"purple":  purple,
		"pink":    pink,
		"teal":    teal,
	}
)

func Tab(n int) string {
	return strings.Repeat("  ", n)
}
